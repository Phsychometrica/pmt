<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychometrica Pro Plus</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Noto+Sans+Devanagari&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <header>
            <div class="brain-icon"><i class="fas fa-brain"></i></div>
            <h1>Psychometrica <span class="pro">Pro</span> Plus</h1>
            <p class="tagline">Unlocking Potential, Shaping Futures</p>
        </header>

        <section id="loading-section">
            <p>Loading application...</p>
        </section>

        <section id="error-section" class="hidden">
            <h2>Error</h2>
            <p id="error-message">Failed to load the application. Please try again later.</p>
            <button class="btn" onclick="retryLoading()"><i class="fas fa-redo"></i> Retry</button>
        </section>

        <section id="login-section" class="hidden">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Enter username" aria-label="Username">
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter password" aria-label="Password">
            </div>
            <div class="form-group">
                <label for="secret-key">Secret Key:</label>
                <input type="password" id="secret-key" placeholder="Enter secret key" aria-label="Secret Key">
            </div>
            <button class="btn" onclick="login()"><i class="fas fa-sign-in-alt"></i> Login</button>
        </section>

        <!-- Other sections remain the same as original -->
        <section id="standard-selection" class="hidden">
            <h2>Select Standard</h2>
            <div class="form-group">
                <label for="standard">Grade:</label>
                <select id="standard" aria-label="Select Grade">
                    <option value="">Select Grade</option>
                    <option value="5">5th</option>
                    <option value="6">6th</option>
                    <option value="7">7th</option>
                    <option value="8">8th</option>
                    <option value="9">9th</option>
                    <option value="10">10th</option>
                </select>
            </div>
            <div class="button-group">
                <button class="btn" onclick="showLanguageSelection()"><i class="fas fa-arrow-right"></i> Next</button>
                <button class="btn secondary" onclick="confirmLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </section>

        <section id="language-selection" class="hidden">
            <h2>Select Language</h2>
            <div class="button-group">
                <button class="btn" onclick="startTest('english')"><i class="fas fa-globe"></i> English</button>
                <button class="btn" onclick="startTest('marathi')"><i class="fas fa-globe"></i> ‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
                <button class="btn secondary" onclick="goBack('language-selection')"><i class="fas fa-arrow-left"></i> Back</button>
            </div>
        </section>

        <section id="info-section" class="hidden">
            <h2 id="info-title"></h2>
            <div id="info-step"></div>
            <div class="button-group">
                <button class="btn" id="info-next-btn" onclick="nextInfoStep()"><i class="fas fa-arrow-right"></i> Next</button>
                <button class="btn secondary" id="info-back-btn" onclick="previousInfoStep()"><i class="fas fa-arrow-left"></i> Back</button>
            </div>
        </section>

        <section id="instructions-section" class="hidden">
            <h2 id="instructions-title"></h2>
            <div id="instructions-content"></div>
            <div class="button-group">
                <button class="btn" onclick="showTest()"><i class="fas fa-play"></i> Start Test</button>
                <button class="btn secondary" onclick="goBack('instructions-section')"><i class="fas fa-arrow-left"></i> Back</button>
            </div>
        </section>

        <section id="test-section" class="hidden">
            <h2 id="test-title"></h2>
            <div class="progress-container">
                <p class="progress-label">Your Progress</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text"></div>
            </div>
            <div id="questions"></div>
            <div id="reward-message" class="hidden"></div>
            <div class="button-group">
                <button class="btn secondary" id="back-btn" onclick="previousQuestion()"><i class="fas fa-arrow-left"></i> Back</button>
                <button class="btn" id="next-btn" onclick="nextQuestion()"><i class="fas fa-arrow-right"></i> Next</button>
                <button class="btn" id="submit-btn" onclick="submitTest()"><i class="fas fa-check"></i> Submit</button>
            </div>
        </section>

        <section id="results-section" class="hidden">
            <h2 id="results-title"></h2>
            <div id="trophy-sign" class="hidden">üèÜ</div>
            <div id="result-content"></div>
            <div class="contact-message">
                <p>For detailed discussion and counseling regarding your child's progress plan, please contact us. Share your result with admin now for further processing.</p>
            </div>
            <div class="button-group">
                <button class="btn whatsapp-btn" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i> Share on WhatsApp</button>
                <button class="btn secondary" onclick="confirmLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
                <button class="btn" onclick="copyResultCode()"><i class="fas fa-copy"></i> Copy Result</button>
                <button class="btn" onclick="downloadCertificate()"><i class="fas fa-download"></i> Download Certificate</button>
            </div>
            <div class="branding-footer">
                <p></p>
            </div>
        </section>

        <section id="admin-section" class="hidden">
            <h2>Admin Dashboard</h2>
            <div class="admin-controls">
                <button class="btn" onclick="exportAllToExcel()"><i class="fas fa-file-export"></i> Export All to CSV</button>
                <button class="btn secondary" onclick="clearReports()"><i class="fas fa-trash"></i> Clear Reports</button>
                <button class="btn secondary" onclick="confirmLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
            <div class="admin-form">
                <h3>Generate Student Development Plan</h3>
                <div class="form-group">
                    <label for="plan-student-name">Student's Name:</label>
                    <input type="text" id="plan-student-name" placeholder="Enter student's name" aria-label="Student's Name" required>
                </div>
                <div class="form-group">
                    <label for="plan-age">Age:</label>
                    <input type="number" id="plan-age" placeholder="Enter age" min="10" max="18" aria-label="Age" required>
                </div>
                <div class="form-group">
                    <label for="plan-standard">Standard:</label>
                    <select id="plan-standard" aria-label="Select Grade" required>
                        <option value="">Select Grade</option>
                        <option value="5">5th</option>
                        <option value="6">6th</option>
                        <option value="7">7th</option>
                        <option value="8">8th</option>
                        <option value="9">9th</option>
                        <option value="10">10th</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="plan-score">Score (%):</label>
                    <input type="number" id="plan-score" placeholder="Enter score (0-100)" min="0" max="100" aria-label="Score" required>
                </div>
                <button class="btn" onclick="generateDevelopmentPlan()"><i class="fas fa-cogs"></i> Generate Plan</button>
            </div>
            <div id="plan-content" class="hidden">
                <h3>Development Plan</h3>
                <div id="plan-text"></div>
                <button class="btn" onclick="copyPlan()"><i class="fas fa-copy"></i> Copy Plan</button>
            </div>
            <div id="admin-content"></div>
        </section>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Script Loader -->
    <script>
        // Blogspot script URLs
        const scriptUrls = [
            'https://js58965869456823140008564wdgvbjscript.blogspot.com/p/zetaquantum-873920146528-authjs.html',
            'https://js58965869456823140008564wdgvbjscript.blogspot.com/p/zetaquantum-873920146528-sriptjs.html',
            'https://js58965869456823140008564wdgvbjscript.blogspot.com/p/cryonix-428506913784052-questionsjs.html',
            'https://js58965869456823140008564wdgvbjscript.blogspot.com/p/nexovortex-649381750293-resultjs.html',
            'https://js58965869456823140008564wdgvbjscript.blogspot.com/p/hyperionflux-528493710346892-planjs.html'
        ];

        // Function to show alerts
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 3000);
        }

        // Function to extract JavaScript code from Blogspot HTML
        async function fetchScriptContent(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error ${response.status}`);
                const text = await response.text();
                // Parse HTML to extract script content
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const scripts = doc.getElementsByTagName('script');
                for (let script of scripts) {
                    if (script.textContent.trim()) {
                        return script.textContent.trim();
                    }
                }
                throw new Error('No JavaScript content found in response');
            } catch (error) {
                console.error(`Failed to fetch script from ${url}:`, error);
                throw error;
            }
        }

        // Function to load a script by injecting it into the DOM
        function loadScript(code, url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.text = code;
                script.onerror = () => reject(new Error(`Failed to execute script from ${url}`));
                script.onload = resolve;
                document.head.appendChild(script);
            });
        }

        // Function to load all scripts sequentially
        async function loadScripts() {
            const loadingSection = document.getElementById('loading-section');
            const errorSection = document.getElementById('error-section');
            const loginSection = document.getElementById('login-section');
            const errorMessage = document.getElementById('error-message');

            try {
                for (const url of scriptUrls) {
                    console.log(`Fetching script from ${url}`);
                    const code = await fetchScriptContent(url);
                    await loadScript(code, url);
                    console.log(`Loaded script from ${url}`);
                }
                // All scripts loaded successfully
                if (loadingSection) loadingSection.classList.add('hidden');
                if (loginSection) loginSection.classList.remove('hidden');
                // Register service worker if supported
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js').catch(err => {
                        console.warn('Service Worker registration failed:', err);
                    });
                }
            } catch (error) {
                console.error('Script loading failed:', error);
                if (loadingSection) loadingSection.classList.add('hidden');
                if (errorSection) errorSection.classList.remove('hidden');
                if (errorMessage) errorMessage.textContent = `Failed to load application: ${error.message}`;
                showAlert('error', 'Failed to load application scripts.');
            }
        }

        // Retry loading scripts
        function retryLoading() {
            const errorSection = document.getElementById('error-section');
            const loadingSection = document.getElementById('loading-section');
            if (errorSection) errorSection.classList.add('hidden');
            if (loadingSection) loadingSection.classList.remove('hidden');
            loadScripts();
        }

        // Start loading scripts
        loadScripts();
    </script>
</body>
</html>
